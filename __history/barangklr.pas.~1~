unit Unit5;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.DB, Vcl.Grids, Vcl.DBGrids,
  Vcl.StdCtrls, Vcl.ExtCtrls, FireDAC.Stan.Intf, FireDAC.Stan.Option,
  FireDAC.Stan.Error, FireDAC.UI.Intf, FireDAC.Phys.Intf, FireDAC.Stan.Def,
  FireDAC.Stan.Pool, FireDAC.Stan.Async, FireDAC.Phys, FireDAC.Phys.MySQL,
  FireDAC.Phys.MySQLDef, FireDAC.VCLUI.Wait, FireDAC.Stan.Param, FireDAC.DatS,
  FireDAC.DApt.Intf, FireDAC.DApt, FireDAC.Comp.DataSet, FireDAC.Comp.Client;

type
  TFBarangkeluar = class(TForm)
    GroupBox1: TGroupBox;
    Label3: TLabel;
    Label4: TLabel;
    Label5: TLabel;
    Button1: TButton;
    Edit1: TEdit;
    Edit3: TEdit;
    DBGrid1: TDBGrid;
    Button2: TButton;
    Label1: TLabel;
    Label2: TLabel;
    Label6: TLabel;
    Label7: TLabel;
    Label8: TLabel;
    Edit4: TEdit;
    Timer1: TTimer;
    FDConnection1: TFDConnection;
    FDQuery1: TFDQuery;
    DataSource1: TDataSource;
    FDQuery1kode_barang: TStringField;
    FDQuery1nama_barang: TStringField;
    FDQuery1jmlh_stock: TIntegerField;
    FDQuery1penerima: TStringField;
    FDQuery1tanggal_transaksi: TDateTimeField;
    ComboBox1: TComboBox;
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure Timer1Timer(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure ComboBox1Change(Sender: TObject);
  private
    { Private declarations }
    procedure PopulateComboBox;
  public
    { Public declarations }
  end;

var
  FBarangkeluar: TFBarangkeluar;

implementation

{$R *.dfm}

uses Unit1;

procedure TFBarangkeluar.ComboBox1Change(Sender: TObject);
var
  NameToCodeMapping: TStringList;
begin
  NameToCodeMapping := FBarangmasuk.BuildNameToCodeMapping;
  try
    // Retrieve the item code based on the selected item name
    Edit1.Text := NameToCodeMapping.Values[ComboBox1.Text];
  finally
    NameToCodeMapping.Free;
  end;
end;

procedure TFBarangkeluar.FormClose(Sender: TObject; var Action: TCloseAction);
begin
  // Clear all input fields
  Edit1.Text := '';
  Edit3.Text := '';
  Edit4.Text := '';
  ComboBox1.ItemIndex := -1; // Reset the ComboBox selection to no item selected

  // Set focus to Button1
  Button1.SetFocus;

  // Hide the form
  SendToBack;
  Hide;

  // Show the main form (FBarangmasuk)
begin
  SendToBack;
  Hide;
  if Assigned(FBarangmasuk) then
    begin
      FBarangmasuk.Show;
      FBarangmasuk.BringToFront;
    end;
end;
end;

procedure TFBarangkeluar.FormShow(Sender: TObject);
begin
 PopulateComboBox;
end;

procedure TFBarangkeluar.PopulateComboBox;
var
  AvailableStock: TStringList;
  i: Integer;
begin
  ComboBox1.Items.Clear;
  AvailableStock := FBarangmasuk.GetAvailableStock;
  try
    for i := 0 to AvailableStock.Count - 1 do
      ComboBox1.Items.Add(AvailableStock[i]);
  finally
    AvailableStock.Free;
  end;
end;

procedure TFBarangkeluar.Timer1Timer(Sender: TObject);
begin
  Label6.Caption:= TimeToStr(now);
  Label7.Caption:= DateToStr(now);
end;

end.
